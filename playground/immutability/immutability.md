# Immutability

함수형 programming의 특징인 불변성(immutability)을 따르려면 두 가지 규칙을 지켜야 한다.

* 지역 변수를 변경하면 안된다.
* 함수 결과에 미치는 영향을 없애기 위해 함수 내에서 전역 변수에 접근하면 안된다.

함수형 programming의 핵심 요소는 불변 객체다. 불변 객체를 통해 얻을 수 있는 이득은 다음과 같다.

* 외부 상태가 변경되지 않으므로 부작용을 없앨 수 있다. 또 변경이 필요하다면, 새로운 객체 instance를 생성해서 객체 내부의 값을 수정할 수 있다.
* 잘못된 객체 상태가 존재하지 않는다. 왜냐하면 현재 객체의 상태를 바꾸는 것이 아니라 변경할 값으로 새로운 객체를 만들기 때문이다.
* Lock 없이 여러 개의 함수를 함께 실행할 수 있기 때문에 thread에 안전하다. 즉, 동기화 이슈를 피할 수 있다.

## Immutable Class

모든 member 변수는 `const`로 선언한다. 따라서 생성자를 통해서만 변수 값을 설정할 수 있다.

`const`로 설정된 객체는 C++11의 최적화 방법인 이동(move) 연산을 막는다. 일반적으로 어떤 객체를 이동하면 해당 객체는 수정될 것이므로, 이렇게 수정이 발생할 수 있는 함수로 `const` 객체를 전달하지 못하도록 C++ 언어 차원에서 막는다. 그래서 `const` 객체에 대해 이동 연산을 시도하면 실제로는 복사 연산이 일어난다.

읽기용 함수는 값 대신에 `const` 참조를 반환한다. 불변 객체의 값을 수정할 수 없기 때문에 참조를 반환하는 것이 더 좋다.
